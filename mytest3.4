using System;
using System.IO;

namespace School
{
    internal class Program
    {
        static void Main(string[] args)
        {
            char wall = '#';
            char player = '$';
            bool isPlaying = true;
            int playerPositionX;
            int playerPositionY;
            int playerPositionXDirectionally = 0;
            int playerPositionYDirectionally = 0;
            char[,] map = ReadMap("map1", out playerPositionX, out playerPositionY,player);
            Console.CursorVisible = false;

            Draw(map);

            while (isPlaying)
            {
                MoveDirectionally(playerPositionXDirectionally, playerPositionYDirectionally, ref playerPositionX, ref playerPositionY, map,player,wall);
            }
        }

        static void MoveDirectionally(int playerPositionXDirectionally, int playerPositionYDirectionally, ref int playerPositionX, ref int playerPositionY, char[,] map,char player,char wall)
        {
            const ConsoleKey CommandUpArrowKey = ConsoleKey.UpArrow;
            const ConsoleKey CommandDownArrowKey = ConsoleKey.DownArrow;
            const ConsoleKey CommandLeftArrowKey = ConsoleKey.LeftArrow;
            const ConsoleKey CommandRightArrowKey = ConsoleKey.RightArrow;

            int zeroPosition = 0;
            int moveUp = -1;
            int moveDown = 1;
            int moveLeft = -1;
            int moveRight = 1;

            if (Console.KeyAvailable)
            {
                ConsoleKeyInfo key = Console.ReadKey(true);

                switch (key.Key)
                {
                    case CommandUpArrowKey:
                        playerPositionXDirectionally = moveUp;
                        playerPositionYDirectionally = zeroPosition;
                        break;

                    case CommandDownArrowKey:
                        playerPositionXDirectionally = moveDown;
                        playerPositionYDirectionally = zeroPosition;
                        break;

                    case CommandLeftArrowKey:
                        playerPositionXDirectionally = zeroPosition;
                        playerPositionYDirectionally = moveLeft;
                        break;

                    case CommandRightArrowKey:
                        playerPositionXDirectionally = zeroPosition;
                        playerPositionYDirectionally = moveRight;
                        break;
                }

                if (map[playerPositionX + playerPositionXDirectionally, playerPositionY + playerPositionYDirectionally] != wall)
                {

                    Move(ref playerPositionX, ref playerPositionXDirectionally, ref playerPositionY, ref playerPositionYDirectionally, map, player);

                }
            }
        }

        static void Draw(char[,] map)
        {

            for (int i = 0; i < map.GetLength(0); i++)
            {

                for (int j = 0; j < map.GetLength(1); j++)
                {
                    Console.Write(map[i, j]);
                }
                Console.WriteLine();
            }
        }

        static char[,] ReadMap(string mapName, out int playerX, out int playerY,char player)
        {
            playerX = 0;
            playerY = 0;

            string[] newFile = File.ReadAllLines($"Maps/{mapName}.txt");
            char[,] map = new char[newFile.Length, newFile[0].Length];

            for (int i = 0; i < map.GetLength(0); i++)
            {

                for (int j = 0; j < map.GetLength(1); j++)
                {
                    map[i, j] = newFile[i][j];

                    if (map[i, j] == player)
                    {
                        playerX = i;
                        playerY = j;
                    }
                }
            }
            return map;
        }

        static void ClearAndSetCursorPosition(int playerPositionY, int playerPositionX, char symbol = ' ')
        {
            Console.SetCursorPosition(playerPositionY, playerPositionX);
            Console.Write(symbol);
        }

        static void Move(ref int playerPositionX, ref int playerPositionXDirectionally, ref int playerPositionY, ref int playerPositionYDirectionally, char[,] map,char player)
        {
            ClearAndSetCursorPosition(playerPositionY, playerPositionX);

            playerPositionX += playerPositionXDirectionally;
            playerPositionY += playerPositionYDirectionally;

            ClearAndSetCursorPosition(playerPositionY, playerPositionX, player);
        }
    }
}
